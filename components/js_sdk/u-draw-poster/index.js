!function(e,t){for(var n in t)e[n]=t[n];t.__esModule&&Object.defineProperty(e,"__esModule",{value:!0})}(exports,(()=>{"use strict";var e={130:(e,t,n)=>{var i;n.r(t),n.d(t,{DrawAnimation:()=>h,DrawPoster:()=>u,default:()=>T,useDrawPoster:()=>m,useDrawPosters:()=>y});const o=null===(i=null===process||void 0===process?void 0:process.env)||void 0===i?void 0:i.VUE_APP_PLATFORM,s="undefined"!=typeof uni?uni:"undefined"!=typeof wx?wx:uni,r=(e,t,n=((e,t)=>{}))=>{for(const i in t)e[i]=n(t[i].handle,t[i].init)||t[i].handle};var a=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};let l={},c={};class d{constructor(e,t,n,i,d,u,h,g){if(this.canvas=e,this.ctx=t,this.canvasId=n,this.loading=i,this.drawImageTime=d,this.debugging=u,this.loadingText=h,this.createText=g,this.executeOnions=[],this.stopStatus=!1,this.debuggingLog=(e,t)=>{this.debugging&&(t?console.log(`%c${this.canvasId} -> ${e}`,"color: #3489fd",t):console.log(`%c${this.canvasId} -> ${e}`,"color: #3489fd"))},this.draw=e=>{const t=this.executeOnions.length;this.executeOnions.push((()=>a(this,void 0,void 0,(function*(){var n,i;try{return this.ctx.save(),yield e(this.ctx),this.ctx.restore(),!0}catch(e){return!((null===(i=null===(n=null==e?void 0:e.message)||void 0===n?void 0:n.search)||void 0===i?void 0:i.call(n,"'nodeId' of undefined"))>=0)&&console.error(`${this.canvasId} -> 绘画栈(${t})，绘制错误：`,e),!1}}))))},this.awaitCreate=()=>a(this,void 0,void 0,(function*(){this.debuggingLog("绘制海报中..."),this.loading&&uni.showLoading({title:this.loadingText});const e=[];for(let t=0;t<this.executeOnions.length;t++){const n=this.executeOnions[t];e.push(yield n())}return this.executeOnions=[],this.debuggingLog("绘制状况",e),"type2d"===this.drawType?(this.loading&&uni.hideLoading(),e):yield new Promise((t=>{if(this.ctx.draw(!0,(()=>{t(e),this.loading&&uni.hideLoading()})),"app-plus"===o){const n=this.ctx.existDrawImage?this.drawImageTime:0;this.ctx.existDrawImage=!1,setTimeout((()=>{t(e),this.loading&&uni.hideLoading()}),n)}}))})),this.createImagePath=(e={})=>a(this,void 0,void 0,(function*(){const{canvas:t,canvasId:n,executeOnions:i,awaitCreate:o}=this;if(i.length&&(yield o()),this.stopStatus)return this.stopStatus=!1,"---stop createImagePath---";this.loading&&uni.showLoading({title:this.createText});const r=Object.assign({x:0,y:0,width:t.width,height:t.height,destWidth:2*t.width,destHeight:2*t.height},e);return"context"===this.drawType&&(r.canvasId=n),"type2d"===this.drawType&&(r.canvas=t),new Promise(((e,t)=>{r.success=t=>{e(t.tempFilePath),this.loading&&uni.hideLoading(),this.debuggingLog("绘制成功 🎉",t)},r.fail=e=>{t(e),this.loading&&uni.hideLoading(),this.debuggingLog("绘制失败 🌟",e)},s.canvasToTempFilePath(r)}))})),this.stop=()=>{this.executeOnions=[],this.stopStatus=!0},!e||!t||!n)throw new Error("DrawPoster Error: Use DrawPoster.build(string | ops) to build drawPoster instance objects");this.drawType=t.draw?"context":"type2d",r(this,l,((e,t)=>(null==t||t(this),(...t)=>e(this,...t)))),r(this.ctx,c,((e,t)=>(null==t||t(this.canvas,this.ctx),(...t)=>e(this.canvas,this.ctx,...t))));const v=this,p=getCurrentPages(),f=p[p.length-1];f.oldOnUnload=f.onUnload,f.onUnload=function(){v.stop(),f.oldOnUnload()}}}d.use=e=>{l[e.name]=e},d.useCtx=e=>{c[e.name]=e},d.build=(e,t=!0)=>a(void 0,void 0,void 0,(function*(){var n;const i=(e=>{let t={selector:"",componentThis:void 0,type2d:!0,loading:!1,drawImageTime:100,debugging:!1,loadingText:"绘制海报中...",createText:"生成图片中..."};"string"==typeof e?t.selector=e:t=Object.assign(Object.assign({},t),e);const n=t.selector;return"mp-weixin"===o&&t.type2d&&(t.selector="#"+t.selector),o||(console.error("注意! draw-poster未开启uni条件编译! 当环境是微信小程序将不会动态切换为type2d模式"),console.error("请在vue.config.js中的transpileDependencies中添加'uni-draw-poster'"),console.error("或者可以在选择器字符串前缀中添加#来切换为type2d绘制(不推荐)"),t.selector=n),t})(e),r=getCurrentPages(),a=r[r.length-1];if(a[i.selector+"__dp"])return a[i.selector+"__dp"];const l=yield(c=i.selector,u=i.componentThis,new Promise((e=>{(u?s.createSelectorQuery().in(u):s.createSelectorQuery()).select(c).fields({node:!0},(t=>{const n=null==t?void 0:t.node;e(n||{})})).exec()})));var c,u;const h=(null===(n=l.getContext)||void 0===n?void 0:n.call(l,"2d"))||s.createCanvasContext(i.selector,i.componentThis);t&&console.log("%cdraw-poster 构建完成：","#E3712A",{canvas:l,ctx:h,selector:i.selector});const g=new d(l,h,i.selector,i.loading,i.drawImageTime,i.debugging,i.loadingText,i.createText);return a[i.selector+"__dp"]=g,g})),d.buildAll=e=>a(void 0,void 0,void 0,(function*(){const t=yield Promise.all(e.map((e=>a(void 0,void 0,void 0,(function*(){return yield d.build(e,!1)}))))),n={};return t.forEach((e=>n[e.canvasId]=e)),console.log("%cdraw-poster 构建完成：","#E3712A",n),n}));const u=d;class h{}var g=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};const v={name:"drawImage",init:(e,t)=>{t.oldDrawImage=t.drawImage},handle:(e,t,n,i,o,r,a)=>g(void 0,void 0,void 0,(function*(){const l=yield(e=>{const t=/^\s*data:(?:[a-z]+\/[a-z0-9-+.]+(?:;[a-z-]+=[a-z0-9-]+)?)?(?:;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)||/http:\/\/temp\/wx/.test(e)||!(e=>/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?$/.test(e))(e);return new Promise(((n,i)=>{if(t)return n(e);s.downloadFile({url:e,success:e=>n(e.tempFilePath),fail:i})}))})(n);t.existDrawImage=!0;let c=!1;return(null==e?void 0:e.createImage)?c=yield new Promise((n=>{const s=e.createImage();s.src=l,s.onload=()=>{t.oldDrawImage(s,i,o,r,a),t.restore(),n(!0)},s.onerror=()=>n(!1)})):(t.oldDrawImage(l,i,o,r,a),t.restore(),c=!0),c}))},p={name:"fillWarpText",handle:(e,t,n)=>{const i=n=Object.assign({maxWidth:100,layer:2,lineHeight:Number(t.font.replace(/[^0-9.]/g,"")),x:0,y:Number(t.font.replace(/[^0-9.]/g,""))/1.2,splitText:"",notFillText:!1},n),{text:o,splitText:s,maxWidth:r,layer:a,lineHeight:l,notFillText:c,x:d,y:u}=i;if(!o)throw Error("warpFillText Error: text is empty string");const h=o.split(s);let g=[],v="";if(s)g=h;else{for(let e=0;e<h.length&&!(g.length>a);e++)t.measureText(v).width<r?v+=h[e]:(e--,g.push(v),v="");if(v&&g.push(v),g.length>a){g=g.slice(0,a);const e=a-1;for(let n=0;n<g[e].length;n++){if(!(t.measureText(g[e]+"...").width>r)){g[e]+="...";break}{const t=g[e].length-1;g[e]=g[e].slice(0,t)}}}}return g.map(((e,n)=>{const i={text:e,y:u+n*l,x:d};return c||t.fillText(i.text,i.x,i.y),i}))}},f={name:"roundRect",handle:(e,t,n,i,o,s,r=15,a=!1,l=!1)=>{o<2*r&&(r=o/2),s<2*r&&(r=s/2),t.beginPath(),t.arc(n+r,i+r,r,Math.PI,1.5*Math.PI),t.moveTo(n+r,i),t.lineTo(n+o-r,i),t.lineTo(n+o,i+r),t.arc(n+o-r,i+r,r,1.5*Math.PI,2*Math.PI),t.lineTo(n+o,i+s-r),t.lineTo(n+o-r,i+s),t.arc(n+o-r,i+s-r,r,0,.5*Math.PI),t.lineTo(n+r,i+s),t.lineTo(n,i+s-r),t.arc(n+r,i+s-r,r,.5*Math.PI,Math.PI),t.lineTo(n,i+r),t.lineTo(n+r,i),l&&t.stroke(),a&&t.fill(),t.closePath()}},x={name:"drawRoundImage",handle:(e,t,n,i,o,s,r,a=15)=>g(void 0,void 0,void 0,(function*(){var e;return t.save(),null===(e=t.setFillStyle)||void 0===e||e.call(t,"transparent"),t.fillStyle="transparent",t.fillRoundRect(i,o,s,r,a),t.clip(),yield t.drawImage(n,i,o,s,r)}))};var w=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};u.useCtx(v),u.useCtx(p),u.useCtx(f),u.useCtx({name:"fillRoundRect",handle:(e,t,n,i,o,s,r)=>{t.roundRect(n,i,o,s,r,!0)}}),u.useCtx({name:"strokeRoundRect",handle:(e,t,n,i,o,s,r)=>{t.roundRect(n,i,o,s,r,!1,!0)}}),u.useCtx(x);const m=e=>w(void 0,void 0,void 0,(function*(){return yield u.build(e)})),y=e=>w(void 0,void 0,void 0,(function*(){return yield u.buildAll(e)})),T=u}},t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}return n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(130)})());